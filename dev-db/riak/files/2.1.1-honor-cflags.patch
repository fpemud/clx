diff -ur riak-2.1.1.orig/deps/eleveldb/c_src/build_deps.sh riak-2.1.1/deps/eleveldb/c_src/build_deps.sh
--- riak-2.1.1.orig/deps/eleveldb/c_src/build_deps.sh	2015-05-07 01:41:48.000000000 +0800
+++ riak-2.1.1/deps/eleveldb/c_src/build_deps.sh	2015-05-09 17:12:28.296757153 +0800
@@ -62,10 +62,9 @@
     *)
         if [ ! -d snappy-$SNAPPY_VSN ]; then
             tar -xzf snappy-$SNAPPY_VSN.tar.gz
-            (cd snappy-$SNAPPY_VSN && ./configure --prefix=$BASEDIR/system --libdir=$BASEDIR/system/lib --with-pic)
         fi
 
-        (cd snappy-$SNAPPY_VSN && $MAKE && $MAKE install)
+        (cd snappy-$SNAPPY_VSN && ./configure --prefix=$BASEDIR/system --with-pic && $MAKE && $MAKE install)
 
         export CFLAGS="$CFLAGS -I $BASEDIR/system/include"
         export CXXFLAGS="$CXXFLAGS -I $BASEDIR/system/include"
diff -ur riak-2.1.1.orig/deps/eleveldb/c_src/leveldb/Makefile riak-2.1.1/deps/eleveldb/c_src/leveldb/Makefile
--- riak-2.1.1.orig/deps/eleveldb/c_src/leveldb/Makefile	2015-05-07 01:41:48.000000000 +0800
+++ riak-2.1.1/deps/eleveldb/c_src/leveldb/Makefile	2015-05-09 17:08:41.013767360 +0800
@@ -9,9 +9,10 @@
 # Uncomment exactly one of the lines labelled (A), (B), and (C) below
 # to switch between compilation modes.
 
-OPT ?= -O2 -g -DNDEBUG    # (A) Production use (optimized mode)
+#OPT ?= -O2 -g -DNDEBUG    # (A) Production use (optimized mode)
 # OPT ?= -g2              # (B) Debug mode, w/ full line-level debugging symbols
 # OPT ?= -O2 -g2 -DNDEBUG # (C) Profiling mode: opt, but w/debugging symbols
+OPT ?=  # (D) Honor system flags mode
 #-----------------------------------------------
 
 # detect what platform we're building on
diff -ur riak-2.1.1.orig/deps/eleveldb/c_src/snappy-1.0.4/configure riak-2.1.1/deps/eleveldb/c_src/snappy-1.0.4/configure
--- riak-2.1.1.orig/deps/eleveldb/c_src/snappy-1.0.4/configure	2011-09-16 03:29:20.000000000 +0800
+++ riak-2.1.1/deps/eleveldb/c_src/snappy-1.0.4/configure	2015-05-09 17:10:26.615762617 +0800
@@ -3930,13 +3930,13 @@
   CFLAGS=$ac_save_CFLAGS
 elif test $ac_cv_prog_cc_g = yes; then
   if test "$GCC" = yes; then
-    CFLAGS="-g -O2"
+    CFLAGS=
   else
     CFLAGS="-g"
   fi
 else
   if test "$GCC" = yes; then
-    CFLAGS="-O2"
+    CFLAGS=
   else
     CFLAGS=
   fi
@@ -10934,13 +10934,13 @@
   CXXFLAGS=$ac_save_CXXFLAGS
 elif test $ac_cv_prog_cxx_g = yes; then
   if test "$GXX" = yes; then
-    CXXFLAGS="-g -O2"
+    CXXFLAGS=
   else
     CXXFLAGS="-g"
   fi
 else
   if test "$GXX" = yes; then
-    CXXFLAGS="-O2"
+    CXXFLAGS=
   else
     CXXFLAGS=
   fi
@@ -11319,13 +11319,13 @@
   CXXFLAGS=$ac_save_CXXFLAGS
 elif test $ac_cv_prog_cxx_g = yes; then
   if test "$GXX" = yes; then
-    CXXFLAGS="-g -O2"
+    CXXFLAGS=
   else
     CXXFLAGS="-g"
   fi
 else
   if test "$GXX" = yes; then
-    CXXFLAGS="-O2"
+    CXXFLAGS=
   else
     CXXFLAGS=
   fi
diff -ur riak-2.1.1.orig/deps/eleveldb/rebar.config riak-2.1.1/deps/eleveldb/rebar.config
--- riak-2.1.1.orig/deps/eleveldb/rebar.config	2015-05-07 01:41:48.000000000 +0800
+++ riak-2.1.1/deps/eleveldb/rebar.config	2015-05-09 17:07:16.589771152 +0800
@@ -14,9 +14,9 @@
 
 {port_env, [
          %% Make sure to set -fPIC when compiling leveldb
-             {"CFLAGS", "$CFLAGS -Wall -O3 -fPIC"},
-             {"CXXFLAGS", "$CXXFLAGS -Wall -O3 -fPIC"},
-             {"DRV_CFLAGS", "$DRV_CFLAGS -O3 -Wall -I c_src/leveldb/include"},
+             {"CFLAGS", "$CFLAGS -fPIC"},
+             {"CXXFLAGS", "$CXXFLAGS -fPIC"},
+             {"DRV_CFLAGS", "$DRV_CFLAGS -I c_src/leveldb/include"},
              {"DRV_LDFLAGS", "$DRV_LDFLAGS c_src/leveldb/libleveldb.a c_src/system/lib/libsnappy.a -lstdc++"}
              ]}.
 
diff -ur riak-2.1.1.orig/deps/erlang_js/c_src/Makefile riak-2.1.1/deps/erlang_js/c_src/Makefile
--- riak-2.1.1.orig/deps/erlang_js/c_src/Makefile	2014-04-12 04:39:20.000000000 +0800
+++ riak-2.1.1/deps/erlang_js/c_src/Makefile	2015-05-09 17:14:20.235752125 +0800
@@ -25,20 +25,18 @@
 js: $(LIB_DIR)/libjs.a
 
 $(LIB_DIR)/libjs.a: $(LIB_DIR)/libnspr4.a
-	$(GUNZIP) -c js-$(SMONKEY_VER).tar.gz | $(TAR) xf -
 	@for I in patches/js-*.patch; do \
 		($(PATCH) -p1 < $${I} || echo "Skipping patch"); \
 	done
-	@$(MAKE) -C $(JS_DIR)/src BUILD_OPT=1 JS_DIST=$(SYSTEM_DIR) \
+	@$(MAKE) -C $(JS_DIR)/src JS_DIST=$(SYSTEM_DIR) \
 		JS_THREADSAFE=1 \
 		XCFLAGS="-DHAVE_VA_COPY -DVA_COPY=va_copy $(CFLAGS)" \
-		XLDFLAGS="$(LDFLAGS)" \
 		-f Makefile.ref
 	@mkdir $(INC_DIR)/js
 	@cp $(JS_DIR)/src/*.h $(INC_DIR)/js
 	@cp $(JS_DIR)/src/*.tbl $(INC_DIR)/js
-	@cp $(JS_DIR)/src/*_OPT.OBJ/*.h $(INC_DIR)/js
-	@cp $(JS_DIR)/src/*_OPT.OBJ/libjs.a $(LIB_DIR)
+	@cp $(JS_DIR)/src/*_DBG.OBJ/*.h $(INC_DIR)/js
+	@cp $(JS_DIR)/src/*_DBG.OBJ/libjs.a $(LIB_DIR)
 
 $(LIB_DIR)/libnspr4.a:
 	$(GUNZIP) -c nsprpub-$(NSPR_VER).tar.gz | $(TAR) xf -
@@ -46,7 +44,7 @@
 		($(PATCH) -p1 < $${I} || echo "Skipping patch"); \
 	done
 	(cd $(NSPR_DIR) && \
-	 ./configure --disable-debug --enable-optimize \
+	 ./configure --disable-debug \
                      --prefix=$(SYSTEM_DIR) $(NSPR_SIXTYFOUR) && \
          $(MAKE) all install)
 
diff -ur riak-2.1.1.orig/deps/erlang_js/c_src/js/src/config.mk riak-2.1.1/deps/erlang_js/c_src/js/src/config.mk
--- riak-2.1.1.orig/deps/erlang_js/c_src/js/src/config.mk	2008-03-12 22:36:06.000000000 +0800
+++ riak-2.1.1/deps/erlang_js/c_src/js/src/config.mk	2015-05-09 17:15:51.139748043 +0800
@@ -122,8 +122,8 @@
 INTERP_OPTIMIZER = -O2 -GL
 LDFLAGS    += -LTCG
 else
-OPTIMIZER  = -Os
-INTERP_OPTIMIZER = -Os
+OPTIMIZER  = 
+INTERP_OPTIMIZER = 
 endif
 DEFINES    += -UDEBUG -DNDEBUG -UDEBUG_$(USER)
 OBJDIR_TAG = _OPT
@@ -132,8 +132,8 @@
 OPTIMIZER  = -Zi
 INTERP_OPTIMIZER = -Zi
 else
-OPTIMIZER  = -g3
-INTERP_OPTIMIZER = -g3
+OPTIMIZER  = 
+INTERP_OPTIMIZER = 
 endif
 DEFINES    += -DDEBUG -DDEBUG_$(USER)
 OBJDIR_TAG = _DBG
